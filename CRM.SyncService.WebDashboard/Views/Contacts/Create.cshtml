@model CRM.SyncService.WebDashboard.Models.Contact
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Tạo Contact Mới";
}

<link href="~/css/contact-create.css" rel="stylesheet" />

<div class="la-page-header">
    <h1 class="la-page-title">
        <i class="bi bi-person-plus-fill"></i>
        Tạo Contact Mới
    </h1>
    <div class="la-breadcrumb">
        <a href="/"><i class="bi bi-house-door"></i> Dashboard</a>
        <i class="bi bi-chevron-right"></i>
        <a href="/Contacts">Contacts</a>
        <i class="bi bi-chevron-right"></i>
        <span>Tạo mới</span>
    </div>
</div>

<div class="la-form-container">
    <form asp-action="Create" method="post">
        <div asp-validation-summary="All" class="la-validation-summary"></div>

        <div class="la-form-section">
            <h3 class="la-section-title">
                <i class="bi bi-info-circle me-2" style="color: var(--la-gold);"></i>
                Thông tin cơ bản
            </h3>

            <div class="la-form-group">
                <label class="la-form-label">
                    Tên liên hệ
                    <span class="required">*</span>
                </label>
                <div class="la-input-with-icon">
                    <i class="bi bi-person la-input-icon"></i>
                    <input asp-for="ContactName" class="la-form-input" placeholder="Nguyễn Văn A" required />
                </div>
            </div>

            <div class="la-form-row">
                <div class="la-form-group">
                    <label class="la-form-label">
                        Số điện thoại
                    </label>
                    <div class="la-input-with-icon">
                        <i class="bi bi-telephone la-input-icon"></i>
                        <input asp-for="Phone" class="la-form-input" placeholder="0912345678" type="tel" />
                    </div>
                </div>

                <div class="la-form-group">
                    <label class="la-form-label">
                        Email
                    </label>
                    <div class="la-input-with-icon">
                        <i class="bi bi-envelope la-input-icon"></i>
                        <input asp-for="Email" class="la-form-input" placeholder="example@@domain.com" type="email" />
                    </div>
                </div>
            </div>

            <div class="la-form-row">
                <div class="la-form-group">
                    <label class="la-form-label">
                        Trạng thái
                    </label>
                    <select asp-for="Status" class="la-form-select">
                        <option value="">-- Chọn trạng thái --</option>
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                        <option value="Pending">Pending</option>
                    </select>
                </div>

                <div class="la-form-group">
                    <label class="la-form-label">
                        Nguồn
                    </label>
                    <select asp-for="Source" class="la-form-select">
                        <option value="">-- Chọn nguồn --</option>
                        <option value="Website">Website</option>
                        <option value="Facebook">Facebook</option>
                        <option value="Google">Google</option>
                        <option value="Referral">Referral</option>
                        <option value="Direct">Direct</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="la-form-section">
            <h3 class="la-section-title">
                <i class="bi bi-link-45deg me-2" style="color: var(--la-gold);"></i>
                Tích hợp
            </h3>

            <div class="la-checkbox-group">
                <input type="checkbox" name="SyncToClickUp" value="true" id="syncCheckbox" class="la-checkbox" />
                <label for="syncCheckbox" class="la-checkbox-label">
                    <i class="bi bi-cloud-check me-1"></i>
                    Đồng bộ với ClickUp
                </label>
            </div>
            <p class="la-checkbox-hint">
                <i class="bi bi-info-circle me-1"></i>
                Contact này sẽ được tự động đồng bộ lên ClickUp khi được tạo
            </p>
        </div>

        <div class="la-form-actions">
            <button type="submit" class="la-btn la-btn-primary">
                <i class="bi bi-check-circle-fill"></i>
                Lưu Contact
            </button>
            <a class="la-btn la-btn-secondary" href="/Contacts">
                <i class="bi bi-x-circle"></i>
                Hủy bỏ
            </a>
        </div>
    </form>
</div>

<script>
    // Auto-format phone number
    var phoneInput = document.querySelector('input[name="Phone"]');
    if (phoneInput) {
        phoneInput.addEventListener('input', function(e) {
            var value = e.target.value.replace(/\D/g, '');
            if (value.length > 10) value = value.slice(0, 10);
            e.target.value = value;
        });
    }

    // Email validation
    var emailInput = document.querySelector('input[name="Email"]');
    if (emailInput) {
        emailInput.addEventListener('blur', function(e) {
            var email = e.target.value;
            var emailRegex = /^[^\s@@]+@@[^\s@@]+\.[^\s@@]+$/;

            if (email && !emailRegex.test(email)) {
                e.target.style.borderColor = '#ef4444';
            } else {
                e.target.style.borderColor = '#e2e8f0';
            }
        });
    }

    // Form submission validation
    var form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function(e) {
            var name = document.querySelector('input[name="ContactName"]').value;

            if (!name || name.trim() === '') {
                e.preventDefault();
                alert('Vui lòng nhập tên liên hệ!');
                return false;
            }
        });
    }

    // Prevent form double submission
    var submitButton = document.querySelector('button[type="submit"]');
    if (submitButton && form) {
        form.addEventListener('submit', function() {
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="bi bi-hourglass-split"></i> Đang lưu...';
            setTimeout(function() {
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="bi bi-check-circle-fill"></i> Lưu Contact';
            }, 3000);
        });
    }
</script>