@model IEnumerable<CRM.SyncService.WebDashboard.Models.Contract>
@{
    ViewData["Title"] = "Quản lý Hợp đồng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/css/contract-index.css" rel="stylesheet" />

<div class="la-page-header">
    <h1 class="la-page-title">
        <i class="bi bi-file-earmark-text-fill"></i>
        Quản lý Hợp đồng
    </h1>
    <a asp-action="Create" class="la-btn-add">
        <i class="bi bi-plus-circle-fill"></i>
        Thêm Hợp đồng mới
    </a>
</div>

<div class="la-table-container">
    @if (Model != null && Model.Any())
    {
        <table class="la-table">
            <thead>
                <tr>
                    <th>Mã HĐ</th>
                    <th>Khách hàng</th>
                    <th>Dịch vụ</th>
                    <th>Tổng tiền</th>
                    <th>Ngày bắt đầu</th>
                    <th>Ngày kết thúc</th>
                    <th>Trạng thái</th>
                    <th style="width: 120px; text-align: center;">Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var c in Model)
                {
                    <tr>
                        <td>
                            <span class="la-contract-code">@c.ContractCode</span>
                        </td>
                        <td>
                            <strong>@(c.Contact?.ContactName ?? "N/A")</strong>
                        </td>
                        <td>@(c.Service?.ServiceName ?? "N/A")</td>
                        <td>
                            <span class="la-amount">@c.TotalAmount.ToString("N0") ₫</span>
                        </td>
                        <td>@c.StartDate.ToString("dd/MM/yyyy")</td>
                        <td>@c.EndDate.ToString("dd/MM/yyyy")</td>
                        <td>
                            @if (c.Status == "Active")
                            {
                                <span class="la-badge la-badge-success">
                                    <i class="bi bi-check-circle-fill"></i>
                                    Hoạt động
                                </span>
                            }
                            else if (c.Status == "Pending")
                            {
                                <span class="la-badge la-badge-warning">
                                    <i class="bi bi-clock-fill"></i>
                                    Chờ duyệt
                                </span>
                            }
                            else if (c.Status == "Expired")
                            {
                                <span class="la-badge la-badge-danger">
                                    <i class="bi bi-x-circle-fill"></i>
                                    Hết hạn
                                </span>
                            }
                            else
                            {
                                <span class="la-badge la-badge-default">@c.Status</span>
                            }
                        </td>
                        <td style="text-align: center;">
                            <a asp-action="Edit" asp-route-id="@c.Id" class="la-action-btn la-action-btn-edit me-1" title="Chỉnh sửa">
                                <i class="bi bi-pencil-fill"></i>
                            </a>
                            <a asp-action="Delete" asp-route-id="@c.Id" class="la-action-btn la-action-btn-delete" title="Xóa" onclick="return confirm('Bạn có chắc chắn muốn xóa hợp đồng này?')">
                                <i class="bi bi-trash-fill"></i>
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <div class="la-empty-state">
            <i class="bi bi-inbox"></i>
            <h4>Chưa có hợp đồng nào</h4>
            <p>Bắt đầu bằng cách thêm hợp đồng mới</p>
        </div>
    }
</div>

<script>
    // Add smooth scroll to top after delete
    document.querySelectorAll('.la-action-btn-delete').forEach(function(btn) {
        btn.addEventListener('click', function(e) {
            if (!confirm('Bạn có chắc chắn muốn xóa hợp đồng này?')) {
                e.preventDefault();
            }
        });
    });

    // Highlight recently added/edited row (if redirected with success message)
    window.addEventListener('load', function() {
        var urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('success')) {
            var firstRow = document.querySelector('.la-table tbody tr');
            if (firstRow) {
                firstRow.style.backgroundColor = 'rgba(212, 164, 89, 0.15)';
                setTimeout(function() {
                    firstRow.style.transition = 'background-color 1s ease';
                    firstRow.style.backgroundColor = '';
                }, 2000);
            }
        }
    });
</script>